<!doctype html>
<html lang="fr">
<head>
<meta charset="utf-8">
<meta http-equiv="x-ua-compatible" content="ie=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="stylesheet" href="//cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.css">
<title>hi monde</title>
</head>
<body data-exercice="<%- data.doc._id %>" data-student="<%- data.name %>" data-ponderation="<%- data.doc.ponderation %>">
<div class="row column">
<h1 class="title">Résultat d'exercice de <%- data.name %></h1>
<nav aria-label="You are here:" role="navigation">
  <ul class="breadcrumbs">
    <li><a href="/">Accueil</a></li>
    <li><a href="/exercices">Exercices</a></li>
    <li class="disabled"><%- data.doc.title %></li>
    <li>
      <span class="show-for-sr">Actuel: </span> Score
    </li>
  </ul>
</nav>
<h2><%- data.doc.title %></h2>
<ul>
<li>Thème: <span class="label"><%- data.doc.theme %></span></li>
<li>Pondération sur <span class="stat"><%- data.doc.ponderation %></span></li>
</ul>
<p><%- data.doc.descriptif || data.doc.description %></p>
<h3>Score</h3>
<pre id="json-score"></pre>

</div>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/jquery/2.2.4/jquery.min.js"></script>
<script type="text/javascript" src="//cdnjs.cloudflare.com/ajax/libs/foundation/6.2.3/foundation.min.js"></script>
<script>
$(function () {
  const score = function ($form, ponderation) {
    const ret = { ponderation: ponderation }
    $form.serializeArray().forEach(function (x) { ret[x.name] = x.value })
    ret.note = parseFloat(ret.note)
    ret.ponderation = parseFloat(ret.ponderation)
    ret.createdAt = new Date().toISOString()
    return ret
  }

  $(document).foundation()
  const bodyData = $('body').data()
  const userUrl = '/_users/org.couchdb.user:' + bodyData.student
  $.getJSON(userUrl, function (userDoc) {
    console.log('got userDoc:', userDoc)
    const score = userDoc.corrections && userDoc.corrections[bodyData.exercice]
    console.log('got userDoc.corrections:', userDoc.corrections)
    if (score) {
      console.log(score)
      $('pre#json-score').text(JSON.stringify(score, null, ' '))
    }
  })
})
</script>
</body>
</html>
